# 股票工具使用指南

## 概述

本系统提供5个核心股票查询工具，所有工具都基于真实的历史数据（akshare），支持49只热门A股股票。

## 数据范围

- **股票数量**：49只热门A股
- **时间跨度**：2020-01-02 至 2026-01-21
- **数据字段**：开盘价、最高价、最低价、收盘价、成交量、涨跌幅
- **数据来源**：akshare（真实市场数据）

## 工具列表

### 1. get_stock_price - 获取股票价格

**功能**：获取指定股票的最新行情信息

**参数**：
- `stock`（字符串）：股票名称或代码，如"比亚迪"或"002594"

**返回**：
- 日期
- 开盘价、最高价、最低价、收盘价
- 成交量
- 涨跌幅

**示例**：
```python
from server.src.tools.stock_tools import get_stock_price_tool

# 使用股票名称
result = get_stock_price_tool.func(stock="比亚迪")
print(result)

# 使用股票代码
result = get_stock_price_tool.func(stock="002594")
print(result)
```

**输出示例**：
```
【比亚迪】最新行情：
日期：2026-01-21
收盘价：94.10元
开盘价：94.01元
最高价：94.94元
最低价：94.00元
成交量：308,334手
涨跌幅：-0.68%
```

---

### 2. get_technical_indicators - 获取技术指标

**功能**：计算并返回常用技术指标

**参数**：
- `stock`（字符串）：股票名称或代码

**返回**：
- **移动平均线**：MA5, MA10, MA20, MA60
- **MACD指标**：DIF, DEA, MACD, 信号（金叉/死叉/持有）
- **RSI指标**：RSI(14)，超买/超卖判断
- **布林带**：上轨、中轨、下轨、当前位置
- **趋势判断**：强势上涨、震荡整理、弱势下跌等
- **支撑/压力位**：近20日的支撑和压力
- **量比**：成交量对比

**示例**：
```python
from server.src.tools.stock_tools import get_technical_indicators_tool

result = get_technical_indicators_tool.func(stock="宁德时代")
print(result)
```

**输出示例**：
```
【宁德时代】技术指标分析：

【移动平均线】
  MA5: 350.88元
  MA10: 356.75元
  MA20: 364.84元
  MA60: 378.13元

【MACD指标】
  DIF: -7.55
  DEA: -5.84
  MACD: -3.42
  信号: 持有

【RSI指标】
  RSI(14): 26.77
  状态: 超卖区域，可能存在反弹机会

【趋势判断】弱势下跌（空头排列）
...
```

---

### 3. get_stock_history - 获取历史数据

**功能**：获取指定股票最近N天的历史交易记录

**参数**：
- `stock`（字符串）：股票名称或代码
- `days`（整数，可选）：天数，默认10天，最多30天

**返回**：
- 每日的日期、收盘价、涨跌幅、成交量
- 统计信息：最高价、最低价、平均价、区间涨跌

**示例**：
```python
from server.src.tools.stock_tools import get_stock_history_tool

result = get_stock_history_tool.func(stock="中国平安", days=10)
print(result)
```

**输出示例**：
```
【中国平安】最近10个交易日数据：

日期           收盘       涨跌幅      成交量         
--------------------------------------------------
2026-01-08     70.38  -4.18%  1,685,392手
2026-01-09     69.00  -1.96%  2,063,348手
...

【统计信息】
  最高价: 73.40元
  最低价: 65.65元
  平均价: 67.46元
  区间涨跌: -6.44%
```

---

### 4. compare_stocks - 比较股票

**功能**：对比多只股票的表现

**参数**：
- `stocks`（字符串列表）：要比较的股票列表，如["比亚迪", "宁德时代"]

**限制**：
- 最少2只，最多5只股票

**返回**：
- 各股票的最新价、今日涨跌、5日涨跌、20日涨跌
- 对比分析：今日/5日/20日涨幅最大的股票

**示例**：
```python
from server.src.tools.stock_tools import compare_stocks_tool

result = compare_stocks_tool.func(stocks=["比亚迪", "宁德时代", "贵州茅台"])
print(result)
```

**输出示例**：
```
【股票对比】共3只

股票         最新价        今日涨跌       5日涨跌       20日涨跌     
------------------------------------------------------------
比亚迪           94.10    -0.68%    -1.64%    -0.75%
宁德时代         349.81     0.06%    -1.11%    -7.48%
贵州茅台        1351.06    -1.64%    -2.72%    -4.03%

【对比分析】
  今日涨幅最大: 宁德时代 (+0.06%)
  5日涨幅最大: 宁德时代 (-1.11%)
  20日涨幅最大: 比亚迪 (-0.75%)
```

---

### 5. analyze_stock - 综合分析

**功能**：对股票进行全面的综合分析

**参数**：
- `stock`（字符串）：股票名称或代码

**返回**：
- 基本行情
- 近期表现（5日、20日、60日）
- 技术指标（MA均线、趋势）
- MACD信号
- RSI超买/超卖状态
- 支撑/压力位
- 量比分析

**示例**：
```python
from server.src.tools.stock_tools import analyze_stock_tool

result = analyze_stock_tool.func(stock="招商银行")
print(result)
```

**输出示例**：
```
【招商银行】综合分析报告
==================================================

【基本行情】
  日期: 2026-01-21
  收盘价: 38.24元
  涨跌幅: -1.27%
  成交量: 1,215,000手
  数据记录: 1468条

【近期表现】
  近5日涨跌: -2.20%
  近20日涨跌: -6.50%
  近60日涨跌: -5.79%

【技术指标】
  MA5: 38.67元
  MA10: 39.35元
  MA20: 40.20元
  MA60: 41.08元
  趋势: 弱势下跌（空头排列）

【MACD】
  信号: 持有
  DIF: -0.72, DEA: -0.49

【RSI】18.11
  状态: 超卖，可能存在反弹机会
...
```

---

## 支持的股票列表

当前系统支持49只热门A股股票，包括但不限于：

### 科技/新能源
- 比亚迪（002594）
- 宁德时代（300750）
- 紫光国微（002049）

### 金融
- 中国平安（601318）
- 招商银行（600036）
- 中信证券（600030）
- 东方财富（300059）

### 消费
- 贵州茅台（600519）
- 五粮液（000858）
- 海天味业（603288）
- 中国中免（601888）

### 能源/基建
- 中国石油（601857）
- 中国石化（600028）
- 中国神华（601088）
- 三一重工（600031）

### 医药
- 恒瑞医药（600276）
- 迈瑞医疗（300760）
- 药明康德（603259）

### 房地产
- 万科A（000002）
- 保利发展（600048）

...以及其他热门股票

---

## 技术实现

### 数据加载
- **模块**：`server/src/data/stock_loader.py`
- **功能**：从parquet文件加载股票数据，支持按名称或代码查询
- **缓存**：自动缓存已加载的数据，提高查询速度

### 技术指标计算
- **模块**：`server/src/data/stock_analyzer.py`
- **功能**：计算MA、MACD、RSI、BOLL等常用技术指标
- **算法**：基于pandas和numpy，标准化计算方法

### 工具封装
- **模块**：`server/src/tools/stock_tools.py`
- **架构**：使用`SimpleTool`类封装，兼容无GPU环境
- **输入验证**：使用Pydantic进行参数验证

---

## 测试

运行完整的工具测试套件：

```bash
python test_tools.py
```

测试覆盖：
- ✅ 工具1：获取股票价格
- ✅ 工具2：获取技术指标
- ✅ 工具3：获取历史数据
- ✅ 工具4：比较股票
- ✅ 工具5：综合分析

---

## 未来扩展

### 即将支持
1. 更多股票（扩展到100+只）
2. 实时数据更新（定时下载）
3. 更多技术指标（KDJ、CCI等）
4. 基本面数据（市盈率、市净率等）
5. 行业对比分析

### Agent集成
这些工具将集成到LangGraph Agent中，支持：
- 自然语言查询（"比亚迪怎么样？"）
- 多步推理（先查价格，再查技术指标）
- 工具链调用（对比多只股票后给出建议）

---

## 常见问题

### Q1：支持哪些股票？
A：当前支持49只热门A股，可以运行`python verify_data.py`查看完整列表。

### Q2：数据多久更新一次？
A：当前是静态数据（截至2026-01-21），未来版本将支持自动更新。

### Q3：如何添加新股票？
A：修改`scripts/download_stock_data.py`中的股票列表，重新运行下载脚本。

### Q4：技术指标的计算准确吗？
A：是的，使用标准算法，与主流交易软件一致。

### Q5：能否查询更早的历史数据？
A：可以，数据从2020年开始，`get_stock_history`工具支持最多30天（可调整）。

---

## 许可与免责

- 数据来源：akshare（公开数据）
- 仅供学习和研究使用
- 不构成任何投资建议
- 投资有风险，入市需谨慎

---

最后更新：2026-01-21
